load("//test/fuzz:fuzz.bzl", "cc_fuzz_test", "cc_smoke_test")


config_setting(
    name = "full_fuzzing",
    flag_values = {
        "//test:enable_full_fuzzing": "true",
    }
)


cc_fuzz_test(
    name = "grow_mpop_fuzz_test",
    srcs = ["grow_mpop_fuzz_test.c"],
    deps = ["//:fildesh_lib"],
    max_guesses = 50000,
)

cc_fuzz_test(
    name = "kv_ensure_fuzz_test",
    srcs = ["kv_ensure_fuzz_test.c"],
    deps = ["//test/lib:kv_rbtree_validation_lib"],
    max_guesses = 50000,
)
cc_smoke_test(
    name = "kv_ensure_smoke_test",
    srcs = [
        "kv_ensure_smoke_test.c",
        "kv_ensure_fuzz_test.c",
    ],
    deps = ["//test/lib:kv_rbtree_validation_lib"],
)

cc_fuzz_test(
    name = "kv_bstree_fuzz_test",
    srcs = [
        "kv_bstree_fuzz_test.c",
        "kv_fuzz_common.c",
        "kv_fuzz_common.h",
    ],
    deps = ["//:fildesh_lib"],
    max_guesses = 50000,
)
cc_smoke_test(
    name = "kv_bstree_smoke_test",
    srcs = [
        "kv_bstree_smoke_test.c",
        "kv_bstree_fuzz_test.c",
        "kv_fuzz_common.c",
        "kv_fuzz_common.h",
    ],
    deps = ["//:fildesh_lib"],
)
cc_fuzz_test(
    name = "kv_broadleaf_bstree_fuzz_test",
    srcs = [
        "kv_broadleaf_bstree_fuzz_test.c",
        "kv_fuzz_common.c",
        "kv_fuzz_common.h",
    ],
    deps = ["//:fildesh_lib"],
    max_guesses = 50000,
)
cc_smoke_test(
    name = "kv_broadleaf_bstree_smoke_test",
    srcs = [
        "kv_broadleaf_bstree_smoke_test.c",
        "kv_broadleaf_bstree_fuzz_test.c",
        "kv_fuzz_common.c",
        "kv_fuzz_common.h",
    ],
    deps = ["//:fildesh_lib"],
)

cc_fuzz_test(
    name = "kv_rbtree_fuzz_test",
    srcs = [
        "kv_rbtree_fuzz_test.c",
        "kv_fuzz_common.c",
        "kv_fuzz_common.h",
    ],
    deps = ["//test/lib:kv_rbtree_validation_lib"],
    max_guesses = 50000,
)
cc_smoke_test(
    name = "kv_rbtree_smoke_test",
    srcs = [
        "kv_rbtree_smoke_test.c",
        "kv_rbtree_fuzz_test.c",
        "kv_fuzz_common.c",
        "kv_fuzz_common.h",
    ],
    deps = ["//test/lib:kv_rbtree_validation_lib"],
)
cc_fuzz_test(
    name = "kv_broadleaf_rbtree_fuzz_test",
    srcs = [
        "kv_broadleaf_rbtree_fuzz_test.c",
        "kv_fuzz_common.c",
        "kv_fuzz_common.h",
    ],
    deps = ["//test/lib:kv_rbtree_validation_lib"],
    max_guesses = 50000,
)
cc_smoke_test(
    name = "kv_broadleaf_rbtree_smoke_test",
    srcs = [
        "kv_broadleaf_rbtree_smoke_test.c",
        "kv_broadleaf_rbtree_fuzz_test.c",
        "kv_fuzz_common.c",
        "kv_fuzz_common.h",
    ],
    deps = ["//test/lib:kv_rbtree_validation_lib"],
)

cc_fuzz_test(
    name = "kv_single_list_fuzz_test",
    srcs = [
        "kv_single_list_fuzz_test.c",
        "kv_fuzz_common.c",
        "kv_fuzz_common.h",
    ],
    deps = ["//:fildesh_lib"],
    max_guesses = 50000,
)
cc_smoke_test(
    name = "kv_single_list_smoke_test",
    srcs = [
        "kv_single_list_smoke_test.c",
        "kv_single_list_fuzz_test.c",
        "kv_fuzz_common.c",
        "kv_fuzz_common.h",
    ],
    deps = ["//:fildesh_lib"],
)

cc_fuzz_test(
    name = "mascii_fuzz_test",
    srcs = ["mascii_fuzz_test.c"],
    deps = ["//:fildesh_lib"],
    max_guesses = 1000000,
)

cc_fuzz_test(
    name = "parse_fildesh_line_fuzz_test",
    srcs = [
        "parse_fildesh_line_fuzz_test.c",
        "//src/syntax:defstr.c",
        "//src/syntax:defstr.h",
        "//src/syntax:line.c",
        "//src/syntax:line.h",
        "//src/syntax:symval.c",
        "//src/syntax:symval.h",
    ],
    deps = ["//:fildesh_lib"],
    max_guesses = 100000,
)
